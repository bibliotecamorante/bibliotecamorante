<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donazione alla Biblioteca Elsa Morante</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <style>
        /* Previous CSS remains the same */
    </style>
</head>
<body>
<div class="container">
    <h1>Donazione alla Biblioteca Elsa Morante</h1>
    <div class="info-box">Compila il modulo per donare i tuoi libri alla biblioteca. Tutti i campi contrassegnati con * sono obbligatori.</div>
    <form id="donationForm">
        <h3>Dati Personali</h3>
        <div class="form-group">
            <label for="nome">Nome:* </label>
            <input type="text" id="nome" name="nome" required>
        </div>
        <div class="form-group">
            <label for="cognome">Cognome:* </label>
            <input type="text" id="cognome" name="cognome" required>
        </div>
        <div class="form-group">
            <label for="tessera">Numero Tessera:</label>
            <input type="text" id="tessera" name="tessera">
        </div>
        <div class="form-group">
            <label for="telefono">Telefono:</label>
            <input type="tel" id="telefono" name="telefono" pattern="[0-9]+" title="Inserire solo numeri">
        </div>
        <div class="form-group">
            <label for="email">Email:* </label>
            <input type="email" id="email" name="email" required>
        </div>
        
        <h3>Libri da donare</h3>
        <div id="bookList"></div>

        <div class="consent-box">
            <label><input type="checkbox" id="accept" name="accept" required> Ho letto e accetto i 
                <a href="https://www.bibliotechediroma.it/sebina/repository/opac/images/Elsa_Morante/TERMINI%20E%20CONDIZIONI.pdf" target="_blank">termini e condizioni</a></label>
        </div>

        <button type="submit">Accetta e Genera il Documento</button>
    </form>
</div>

<script>
let bookCount = 0;

function createBookEntry() {
    const bookDiv = document.createElement('div');
    bookDiv.className = 'book-entry';
    bookCount++;
    bookDiv.innerHTML = `
    <div class="book-counter">${bookCount}</div>
    <div class="form-group">
      <label>Titolo:* </label>
      <input type="text" class="book-title" required>
    </div>
    <div class="form-group">
      <label>Autore:</label>
      <input type="text" class="book-author">
    </div>
    <div class="form-group">
      <label>Editore:</label>
      <input type="text" class="book-publisher">
    </div>
    <div class="form-group">
      <label>Anno:</label>
      <input type="number" class="book-year" min="1000" max="2024">
    </div>
    <div class="form-group">
      <label>ISBN:</label>
      <input type="text" class="book-isbn" pattern="[0-9-]{10,13}" title="Inserire ISBN (solo numeri e trattini, max 13 caratteri)">
    </div>

    <button type='button' class='remove-book' onclick='removeBook(this)'>Rimuovi</button> 
    <button type='button' class='add-book' onclick='createBookEntry()'>+ Aggiungi Libro</button>`;
    
    document.getElementById('bookList').appendChild(bookDiv);
    updateBookCounters();
}

// Resto del codice JavaScript rimane invariato

async function generateExcel(formData, books) {
    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet('Donazione');

    // Stili personalizzati rimangono invariati

    // Imposta larghezza colonne aggiornate
    worksheet.columns = [
        { width: 4 },   // N.
        { width: 70 },  // Titolo (allargata ulteriormente)
        { width: 50 },  // Autore (allargata)
        { width: 45 },  // Editore (allargata)
        { width: 15 },  // Anno
        { width: 40 }   // ISBN (allargata)
    ];

    // Resto della funzione generateExcel rimane invariato
}

// Event Listener e resto del codice rimangono invariati

</script>

</body>
</html>
